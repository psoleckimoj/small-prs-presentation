<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.102.3"><meta charset=utf-8><title>Writing web services in Rust</title><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=/small-prs-presentation/reveal-js/css/reset.css><link rel=stylesheet href=/small-prs-presentation/reveal-js/css/reveal.css><link rel=stylesheet href=/small-prs-presentation/reveal-js/css/theme/black.css id=theme><link rel=stylesheet href=/small-prs-presentation/highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h1 id=are-we-web-yet>Are we web yet?</h1><p>Writing web services in Rust</p></section><section><h2 id=what-is-rust>What is Rust?</h2><ul><li>general purpose programming language</li><li>announced by Mozilla in 2010</li><li>&ldquo;C&rdquo; style syntax</li><li>features you would expect from a modern language</li><li>rising popularity amongst developers</li></ul><aside class=notes><ul><li><a href=https://stackoverflow.blog/2020/06/05/why-the-developers-who-use-rust-love-it-so-much/>Number one most loved language among the 65,000 programmers in StackOverflow survey 2021</a></li></ul></aside></section><section><h2 id=performance>Performance</h2><ul><li>compiled language with no run time</li><li>no garbage collector</li></ul><aside class=notes><ul><li><strong>no garbage collector:</strong> memory is managed at compile time with lifetimes and the borrow checker, resulting in higher performance and lower memory footprint</li></ul></aside></section><section><h2 id=reliability>Reliability</h2><ul><li>statically typed</li><li>type system ensures errors are handled</li><li>ownership guarantees both memory and thread safety</li></ul><aside class=notes><ul><li><strong>[type system]</strong> recoverable errors are propagated using Result, Option and enum types, unrecoverable errors can still panic</li><li><a href=https://www.zdnet.com/article/microsoft-70-percent-of-all-security-bugs-are-memory-safety-issues/>Microsoft: 70 percent of all security bugs are memory safety issues for the last 12 years</a></li></ul></aside></section><section><h2 id=productivity>Productivity</h2><ul><li>compiler provides useful error messages</li><li>best in class package manager and build tool</li><li>extensive documentation</li></ul><aside class=notes><ul><li><strong>[compiler provides useful error messages]</strong> clean, concise errors point you the exact point of failure, often suggest a fix and make fixing easy</li><li><strong>[best in class package manager and build tool]</strong>] build, lint, format and test out the box, plugins for audit etc..</li><li><strong>[extensive documentation]</strong> consistent and accurate, generated by annotating the code, code in documentation is also tested</li></ul></aside></section><section><h2 id=the-rust-language>The Rust language</h2><p>the bits I really like</p></section><section><h2 id=error-handling>Error handling</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>init_db</span>() -&gt; Result<span style=color:#f92672>&lt;</span>PgPool, Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#66d9ef>let</span> database_url <span style=color:#f92672>=</span> env::var(<span style=color:#e6db74>&#34;DATABASE_URL&#34;</span>)<span style=color:#f92672>?</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#66d9ef>match</span> PgPoolOptions::new()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>        .connect(<span style=color:#f92672>&amp;</span>database_url)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>        .<span style=color:#66d9ef>await</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>            Ok(pool) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>                sqlx::migrate<span style=color:#f92672>!</span>(<span style=color:#e6db74>&#34;db/migrations&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>                    .run(<span style=color:#f92672>&amp;</span>pool)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>                    .<span style=color:#66d9ef>await</span><span style=color:#f92672>?</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>                Ok(pool)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>            }, 
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>            Err(e) <span style=color:#f92672>=&gt;</span> Err(e.into())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>}</span></span></code></pre></div><aside class=notes><ul><li><strong>[example]</strong> Result types have to be handled, when designing the API of a library you would want to propagate errors and allow the consumer to either try and recover or panic</li><li><strong>[example]</strong> we propagate with <strong>?</strong> and <strong>match</strong> to apply migrations if we are able to create a connection pool</li></ul></aside></section><section><section data-shortcode-section><h2 id=trait-system>Trait system</h2><p>Derivable traits</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e>#[derive(Debug, Deserialize, Serialize)]</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Person</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    first_name: String,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    family_name: String,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    date_of_birth: <span style=color:#a6e22e>Date</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>}</span></span></code></pre></div><aside class=notes><ul><li><strong>[example]</strong> code generation reduces the need to write boilerplate and speed up development</li></ul></aside></section><section><p>Implementing a trait</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>impl</span> From<span style=color:#f92672>&lt;</span>Claims<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> ReadUser {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>from</span>(claims: <span style=color:#a6e22e>Claims</span>) -&gt; <span style=color:#a6e22e>Self</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>        ReadUser {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>            username: <span style=color:#a6e22e>claims</span>.sub,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#75715e>// Implementing this would allow for the following
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#75715e>// let user = ReadUser::from(claims);
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#75715e>// let user: ReadUser = claims.into();
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#75715e>// fn some_function(user: dyn Into&lt;ReadUser&gt;) {}
</span></span></span></code></pre></div><aside class=notes><ul><li><strong>[example]</strong> they act like java interfaces</li><li><strong>[example]</strong> some traits will give you implementations for others e.g <strong>impl From&lt;A> for B</strong> gives you <strong>impl Into&lt;B> for A</strong></li><li><strong>[example]</strong> we can extend structs from libraries</li><li><strong>[example]</strong> we can use them for operator overloading</li></ul></aside></section></section><section><section data-shortcode-section><h2 id=pattern-matching>Pattern matching</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=nohighlight data-noescape><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>impl</span> IntoResponse <span style=color:#66d9ef>for</span> ApiError {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>into_response</span>(self) -&gt; <span style=color:#a6e22e>axum</span>::response::Response {
</span></span><span style=display:flex;background-color:#3c3d38><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>        <span style=color:#66d9ef>let</span> validation_errors <span style=color:#f92672>=</span> <span style=color:#66d9ef>match</span> <span style=color:#f92672>&amp;</span>self {
</span></span><span style=display:flex;background-color:#3c3d38><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>            ApiError::ValidationError(e) <span style=color:#f92672>=&gt;</span> Some(e),
</span></span><span style=display:flex;background-color:#3c3d38><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>            _ <span style=color:#f92672>=&gt;</span> None,
</span></span><span style=display:flex;background-color:#3c3d38><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>        };
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>        (
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>            self.status_code(),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>            Json(ErrorResponse {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>                message: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>self</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>                errors: <span style=color:#a6e22e>validation_errors</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>            }),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>        ).into_response()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>}</span></span></code></pre></div><aside class=notes><ul><li><strong>[example]</strong> we&rsquo;re using <strong>match</strong> to return an optional value for the validation variant of the error enum</li></ul></aside></section><section><p>They&rsquo;re exhaustive</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>handle_error</span>(error: <span style=color:#a6e22e>sqlx</span>::Error) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#66d9ef>match</span> error {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>        sqlx::Error::Configuration(_) <span style=color:#f92672>=&gt;</span> todo!(),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>        sqlx::Error::Database(_) <span style=color:#f92672>=&gt;</span> todo!(),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>        sqlx::Error::Io(_) <span style=color:#f92672>=&gt;</span> todo!(),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>        sqlx::Error::Tls(_) <span style=color:#f92672>=&gt;</span> todo!(),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>        sqlx::Error::Protocol(_) <span style=color:#f92672>=&gt;</span> todo!(),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>        sqlx::Error::RowNotFound <span style=color:#f92672>=&gt;</span> todo!(),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>        sqlx::Error::TypeNotFound { type_name } <span style=color:#f92672>=&gt;</span> todo!(),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>        sqlx::Error::ColumnIndexOutOfBounds { index, len } <span style=color:#f92672>=&gt;</span> todo!(),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        sqlx::Error::ColumnNotFound(_) <span style=color:#f92672>=&gt;</span> todo!(),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>        sqlx::Error::ColumnDecode { index, source } <span style=color:#f92672>=&gt;</span> todo!(),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>        sqlx::Error::Decode(_) <span style=color:#f92672>=&gt;</span> todo!(),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>        sqlx::Error::PoolTimedOut <span style=color:#f92672>=&gt;</span> todo!(),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>        sqlx::Error::PoolClosed <span style=color:#f92672>=&gt;</span> todo!(),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>        sqlx::Error::WorkerCrashed <span style=color:#f92672>=&gt;</span> todo!(),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>        sqlx::Error::Migrate(_) <span style=color:#f92672>=&gt;</span> todo!(),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>        _ <span style=color:#f92672>=&gt;</span> todo!(),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>}</span></span></code></pre></div><aside class=notes><ul><li><strong>[example]</strong> match statements are required to be exhaustive</li><li><strong>[example]</strong> we can include a default handle with <strong>_</strong></li><li><strong>[example]</strong> they&rsquo;re powerful we can use complex expressions, in this example we have an enum where variants include unit, tuple and struct enum type</li></ul></aside></section></section><section><h2 id=rust-for-web-services>Rust for web services</h2><p>I built a thing and this is what I learned</p></section><section><section data-shortcode-section><h2 id=axum>axum</h2><ul><li>web framework</li><li>part of the Tokio ecosystem</li><li>uses Hyper HTTP libraries</li><li>minimal boilerplate</li><li>really fast<a href="https://web-frameworks-benchmark.netlify.app/compare?f=axum,spring,express">*</a></li></ul><aside class=notes><ul><li>[<strong>axum</strong>] tokio is an async runtime, Rust provides the language constructs and the runtimes are built by the community</li><li>[<strong>axum</strong>] the tokio ecosystem popular choice with backing from contributors such as Amazon, Microsoft and Facebook</li><li>[<strong>benchmarks</strong>] Axum ~140k req/s vs Spring ~70k req/s vs Express ~25k req/s with around half the latency of Spring</li></ul></aside></section><section><h3 id=what-it-looks-like>What it looks like</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#75715e>#[tokio::main]</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#66d9ef>let</span> app <span style=color:#f92672>=</span> Router::new().route(<span style=color:#e6db74>&#34;/&#34;</span>, get(say_hello));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#66d9ef>let</span> addr <span style=color:#f92672>=</span> SocketAddr::from(([<span style=color:#ae81ff>127</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>], <span style=color:#ae81ff>8080</span>));
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    axum::Server::bind(<span style=color:#f92672>&amp;</span>addr)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>        .serve(app.into_make_service())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>        .<span style=color:#66d9ef>await</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>        .unwrap();
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>say_hello</span>() -&gt; <span style=color:#a6e22e>Html</span><span style=color:#f92672>&lt;&amp;&#39;</span>static <span style=color:#66d9ef>str</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    Html(<span style=color:#e6db74>&#34;Hello, World!&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>}</span></span></code></pre></div><aside class=notes><ul><li>[<strong>example</strong>] axum leverages the the type system, using generics and traits to minimise boilerplate</li><li>[<strong>example</strong>] handlers are just async functions that take parameters implementing the FromRequest trait and return values implementing the ToResponse trait</li></ul></aside></section><section><h3 id=other-web-frameworks>Other web frameworks</h3><ul><li><p>Actix web</p><ul><li>tried and tested</li><li>originally built upon the Actix library</li></ul></li><li><p>Rocket</p><ul><li>simple use of macros for code-gen</li><li>good quality documentation</li></ul></li></ul><aside class=notes><ul><li>[<strong>actix</strong>] its being one of the older frameworks it has lots of examples</li><li>[<strong>rocket</strong>] quite opinionated, you get a lot of stuff for free similar to Springboot but you also have to do things their way</li></ul></aside></section></section><section><section data-shortcode-section><h2 id=sqlx>sqlx</h2><ul><li>supports PostgreSQL, MySQL, SQLite, and MSSQL</li><li>compatible with multiple async runtimes</li><li>it&rsquo;s not an ORM</li><li>queries are checked at compile time</li></ul></section><section><h2 id=executing-queries>Executing queries</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>let</span> person <span style=color:#f92672>=</span> sqlx::query_as<span style=color:#f92672>!</span>(
</span></span><span style=display:flex><span>    Person,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>r#&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        INSERT INTO person (first_name, family_name, date_of_birth)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        VALUES ($1, $2, $3)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        RETURNING uuid AS id, created, last_edited, first_name, family_name, date_of_birth;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;#</span>,
</span></span><span style=display:flex><span>    request.first_name,
</span></span><span style=display:flex><span>    request.family_name,
</span></span><span style=display:flex><span>    request.date_of_birth
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>.fetch_one(<span style=color:#f92672>&amp;</span>db)
</span></span><span style=display:flex><span>.<span style=color:#66d9ef>await</span><span style=color:#f92672>?</span>;
</span></span></code></pre></div><aside class=notes><ul><li>[<strong>example</strong>] We use the <strong>query_as!</strong> macro which allows use specify a type to deserialize the result to, the SQL statement is then checked against the database at compile time</li><li>[<strong>example</strong>] Really cool trick, the <strong>rust-analyser</strong> extension expands this macro when writing code, so you get feedback before you even run <strong>cargo build</strong></li></ul></aside></section><section><h2 id=applying-migrations>Applying migrations</h2><p>Programmatically</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sqlx::migrate<span style=color:#f92672>!</span>(<span style=color:#e6db74>&#34;db/migrations&#34;</span>).run(<span style=color:#f92672>&amp;</span>pool).<span style=color:#66d9ef>await</span><span style=color:#f92672>?</span>;</span></span></code></pre></div><p>Using the CLI</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sqlx migrate run --source<span style=color:#f92672>=</span>db/migrations</span></span></code></pre></div><aside class=notes><ul><li>[<strong>sqlx</strong>] migrations remind me of Flyway, you just write SQL and go</li></ul></aside></section><section><h3 id=if-you-want-to-use-an-orm>If you want to use an ORM</h3><ul><li><p>Diesel</p><ul><li>a mature library</li><li>robust compile time type checking</li></ul></li><li><p>SeaOrm</p><ul><li>async</li><li>built upon sqlx</li><li>really good tooling with the CLI</li></ul></li></ul><aside class=notes><ul><li>[<strong>diesel</strong>] async will be added as part of the next major release</li><li>[<strong>seaorm</strong>] schema first, the tooling allows you to generate code for entities from a database schema</li></ul></aside></section></section><section><section data-shortcode-section><h2 id=serde-and-validator>serde and validator</h2><ul><li>Serde<ul><li>JSON serialization and deserialization</li><li>derive macros make things quick and easy</li></ul></li><li>Validator<ul><li>macro based validation for DTOs</li><li>a lot of validation out the box</li><li>extendable</li></ul></li></ul><aside class=notes><ul><li>[<strong>serde</strong>] not limited to JSON, similar to Jackson in Java we can serialize and deserialize many types of data</li><li>[<strong>validator</strong>] out of the box you get validation for numerical values and string types such as credit card and telephone numbers</li><li>[<strong>validator</strong>] can be extended with simple functions</li></ul></aside></section><section><h2 id=building-a-dto>Building a DTO</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e>#[derive(Debug, Validate, Deserialize)]</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>NewPerson</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#75715e>#[validate(length(min = 1, max = 64))]</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    first_name: String,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    <span style=color:#75715e>#[validate(length(min = 1, max = 64))]</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    family_name: String,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>    <span style=color:#75715e>#[validate(custom = </span><span style=color:#e6db74>&#34;date_not_in_future&#34;</span><span style=color:#75715e>)]</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>    date_of_birth: <span style=color:#a6e22e>Date</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>}</span></span></code></pre></div><aside class=notes><ul><li>[<strong>example</strong>] code gen through macros make it really easy to configure with simple values</li></ul></aside></section><section><h2 id=running-the-validation>Running the validation</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=nohighlight data-noescape><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>create_person</span>(
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    db: <span style=color:#a6e22e>Extension</span><span style=color:#f92672>&lt;</span>PgPool<span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    Json(request): <span style=color:#a6e22e>Json</span><span style=color:#f92672>&lt;</span>NewPerson<span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>) -&gt; Result<span style=color:#f92672>&lt;</span>(StatusCode, Json<span style=color:#f92672>&lt;</span>Person<span style=color:#f92672>&gt;</span>), ApiError<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex;background-color:#3c3d38><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    request.validate()<span style=color:#f92672>?</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#75715e></span>}</span></span></code></pre></div><aside class=notes><ul><li>[<strong>example</strong>] combining this with a library like thiserror you will be able to convert the error and propagate it using the <strong>?</strong> operator</li></ul></aside></section></section><section><h2 id=so-what-did-i-not-like>So what did I not like?</h2><ul><li>maturity of some of the libraries</li><li>documentation is generally good, but examples can be lacking</li><li>the borrow checker and lifetimes still kick my ass from time to time</li></ul><aside class=notes><ul><li>[<strong>maturity</strong>] there&rsquo;s still some issues where you need some features from a new update but other libraries use incompatible versions</li><li>[<strong>examples can be lacking</strong>] specifically real world examples for newer libraries that have less usage</li><li>[<strong>the borrow checker</strong>] not a bad thing just a learning curve</li></ul></aside></section><section><h2 id=useful-links>Useful links</h2><ul><li><a href=https://www.rust-lang.org/>the official Rust website</a></li><li><a href=https://doc.rust-lang.org/book/>the Rust book</a></li><li><a href=https://www.arewewebyet.org/>are we web yet?</a></li><li><a href=https://github.com/LucasCairns/rust-web-app>my rust web service</a></li></ul></section><section><h1 id=questions->Questions? 🤔</h1></section></div></div><script type=text/javascript src=/small-prs-presentation/reveal-hugo/object-assign.js></script>
<a href=/small-prs-presentation/reveal-js/css/print/ id=print-location style=display:none></a>
<script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>null</script><script type=application/json id=reveal-hugo-page-params>{"theme":"black"}</script><script src=/small-prs-presentation/reveal-js/js/reveal.js></script>
<script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=/small-prs-presentation/reveal-js/plugin/markdown/marked.js></script>
<script type=text/javascript src=/small-prs-presentation/reveal-js/plugin/markdown/markdown.js></script>
<script type=text/javascript src=/small-prs-presentation/reveal-js/plugin/highlight/highlight.js></script>
<script type=text/javascript src=/small-prs-presentation/reveal-js/plugin/zoom-js/zoom.js></script>
<script type=text/javascript src=/small-prs-presentation/reveal-js/plugin/notes/notes.js></script>
<script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script>mermaid.initialize({startOnLoad:!1});let render=e=>{let t=e.currentSlide.querySelectorAll(".mermaid");if(!t.length)return;t.forEach(e=>{let t=e.getAttribute("data-processed");t||mermaid.init(void 0,e)})};Reveal.addEventListener("slidechanged",render),Reveal.addEventListener("ready",render)</script></body></html>